- job:
    name: 'Kibana-Selenium-Tests'
    description: Runs Kibana selenium tests on a given node
    logrotate:
        daysToKeep: 30
    parameters:
        - node:
            name: Environment
    builders:
        - shell: |
            #!/bin/bash -x
            #Setup virtual env for the project to build in
            pip install virtualenv

            rm -rf kib-sel-venv
            virtualenv kib-sel-venv
            . kib-sel-venv/bin/activate

            #Pull from github the code and setup the required pip packages.
            sudo rm -rf /opt/kibana-selenium
            cd /opt
            sudo git clone https://github.com/rcbops-qe/kibana-selenium.git
            sudo chmod 777 kibana-selenium
            cd kibana-selenium
            #mv ~/.pip/pip.conf ~/.pip/pip2.conf
            pip install -r requirements.txt
            #mv ~/.pip/pip2.conf ~/.pip/pip.conf
            export PYTHONPATH=$(pwd)
            sudo python conf-gen.py

            #Execute the tests
            python /opt/kibana-selenium/testrepo/kibana/kibana.py
