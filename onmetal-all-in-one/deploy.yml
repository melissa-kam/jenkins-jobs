- job-template:
    name: 'OnMetal-AIO-{deploy-action}'
    logrotate:
        daysToKeep: 30
    parameters:
        - string:
            name: OSA_OPS_REPO
            default: https://github.com/rcbops-qe/openstack-ansible-ops
        - string:
            name: OSA_OPS_BRANCH
            default: master
    scm:
        - git:
            url: $OSA_OPS_REPO
            branches:
                - $OSA_OPS_BRANCH
    wrappers:
      - mask-passwords
      - ansicolor:
            colormap: xterm
    builders:
        - OnMetal-{deploy-action}

- project:
    name: onmetal-all-in-one-deploy
    deploy-action:
        - Build-Host
        - Setup-Host
        - Setup-Cobbler
        - Setup-Virsh
        - Deploy-VMs            
    jobs:
        - 'OnMetal-AIO-{deploy-action}'


- builder:
    name: OnMetal-Build-Host
    description: Creates an OnMetal cloud server.
    builders:
        - shell: |
            #!/bin/bash

- builder:
    name: OnMetal-Setup-Host
    description: Runs all required host setup
    builders:
        - shell: |
            #!/bin/bash
            source setup-host.sh

- builder:
    name: OnMetal-Setup-Cobbler
    description: Runs installation and configuration of Cobbler
    builders:
        - shell: |
            #!/bin/bash
            source setup-cobbler.sh


- builder:
    name: OnMetal-Setup-Virsh
    description: Setup libvirt networks used for the Host VMs
    builders:
        - shell: |
            #!/bin/bash
            source setup-virsh-net.sh

- builder:
    name: OnMetal-Deploy-VMs
    description:
    builders:
        - shell: |
            #!/bin/bash
            source deploy-vms.sh

